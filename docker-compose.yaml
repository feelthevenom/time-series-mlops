version: '3.8'

services:
  sleek-airflow:
    build: .
    image: sleek-airflow:latest
    volumes:
      - ./airflow:/opt/airflow
      - ./src:/app/src
      - ./artifacts:/app/artifacts
    ports:
      - "8080:8080"
    environment:
      - PYTHONPATH=/app:/opt/airflow
    command: airflow standalone
    extra_hosts:
      - "host.docker.internal:host-gateway"

  storedata-db:
    image: influxdb:2
    ports:
      - 8086:8086
    env_file: ".env"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8086/health"]
      interval: 5s
      timeout: 2s
      retries: 12

  data-pusher:
    build: ./data-pusher
    image: data-pusher:latest
    depends_on:
      storedata-db:
        condition: service_healthy